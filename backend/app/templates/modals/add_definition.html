<div id="addDefinitionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4">
    <div class="bg-white rounded-lg sm:rounded-xl shadow-xl max-w-2xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-white border-b border-gray-200 px-4 sm:px-6 py-3 sm:py-4">
            <div class="flex justify-between items-center">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900">Add Card Definition</h2>
                <button onclick="hideModal('addDefinitionModal')" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <form action="/definitions/create" method="POST" enctype="multipart/form-data" class="p-4 sm:p-6 space-y-3 sm:space-y-4">
            <!-- Card Type -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Card Type *</label>
                <select name="card_type" id="card_type" onchange="toggleCardTypeFields()" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="sport">Sport</option>
                    <option value="pokemon">Pokemon</option>
                </select>
            </div>

            <!-- Sport Fields -->
            <div id="sport_fields">
                <label class="block text-sm font-medium text-gray-700 mb-1">Player Name *</label>
                <input type="text" name="player_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <!-- Pokemon Fields -->
            <div id="pokemon_fields" class="hidden space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Pokemon Name *</label>
                    <input type="text" name="pokemon_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Language</label>
                        <input type="text" name="language" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Era</label>
                        <input type="text" name="era" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
            </div>

            <!-- Common Fields -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Year *</label>
                    <input type="text" name="year" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Brand *</label>
                    <input type="text" name="brand" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                    <input type="text" name="card_number" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Rarity</label>
                    <input type="text" name="rarity" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Series</label>
                    <input type="text" name="series" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Insert/Parallel</label>
                    <input type="text" name="insert_parallel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                <textarea name="note" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
            </div>

            <!-- Image Upload - Modern -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Card Image *</label>
                <div class="relative">
                    <input type="file" name="image" id="imageUpload" accept="image/*" required class="hidden" onchange="updateFileName(this)">
                    <label for="imageUpload" class="flex items-center justify-center w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-gray-900 hover:bg-gray-50 transition-all">
                        <div class="text-center">
                            <svg class="mx-auto h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p class="mt-1 text-sm text-gray-600"><span class="font-medium">Click to upload</span> or drag and drop</p>
                            <p class="text-xs text-gray-500 mt-1" id="fileName">PNG, JPG up to 10MB</p>
                        </div>
                    </label>
                </div>
            </div>

            <script>
            function updateFileName(input) {
                const fileName = input.files[0]?.name || 'PNG, JPG up to 10MB';
                document.getElementById('fileName').textContent = fileName;
            }

            // Initialize searchable dropdowns when page loads
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(function() {
                    initSearchableDropdown('#addDefinitionModal input[name="brand"]', 'brand');
                    initSearchableDropdown('#addDefinitionModal input[name="rarity"]', 'rarity');
                    initSearchableDropdown('#addDefinitionModal input[name="series"]', 'series');
                    initSearchableDropdown('#addDefinitionModal input[name="insert_parallel"]', 'insert_parallel');
                    initSearchableDropdown('#addDefinitionModal input[name="era"]', 'era');
                    initSearchableDropdown('#addDefinitionModal input[name="language"]', 'language');
                    initSearchableDropdown('#addDefinitionModal input[name="pokemon_name"]', 'pokemon_name');
                    initSearchableDropdown('#addDefinitionModal input[name="player_name"]', 'player_name');
                }, 500); // Small delay to ensure DOM is ready
            });
            </script>

            <!-- Actions -->
            <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                <button type="button" onclick="hideModal('addDefinitionModal')" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    Create
                </button>
            </div>
        </form>
    </div>
</div>
